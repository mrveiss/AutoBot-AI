metadata:
  name: "Digital Incident Response Workflow"
  category: cybersecurity
  complexity: high
  estimated_time: "2-8 hours"
  version: "1.0.0"
  description: "Comprehensive incident response workflow for security incidents and digital forensics"

objective: "Systematically respond to security incidents, preserve evidence, and restore normal operations while maintaining forensic integrity"

prerequisites:
  - "Incident response team activated"
  - "Proper authorization and legal clearance"
  - "Forensic tools and write-blockers available"
  - "Secure evidence storage prepared"
  - "Communication channels established"
  - "Chain of custody documentation ready"

required_tools:
  - name: dd
    purpose: Create forensic disk images
    optional: false
  - name: volatility
    purpose: Memory dump analysis
    optional: false
  - name: strings
    purpose: Extract readable text from files
    optional: false
  - name: netstat
    purpose: Network connection analysis
    optional: false
  - name: ps
    purpose: Process analysis
    optional: false
  - name: tcpdump
    purpose: Network traffic capture
    optional: true
  - name: wireshark
    purpose: Network packet analysis
    optional: true

workflow_steps:
  - step: 1
    action: "Initial Assessment and Triage"
    details: "Evaluate incident scope and establish priorities"
    commands:
      - "date >> incident_log.txt"
      - "echo 'INCIDENT: {incident_id} - {brief_description}' >> incident_log.txt"
      - "who -a"
      - "last -n 20"
      - "ps aux --sort=-%cpu"
    expected_output: "Initial system state and user activity assessment"
    validation: "Confirm incident classification and severity level"
    time_sensitivity: "Critical - must be completed within 15 minutes"
    documentation:
      - "Record incident discovery time and method"
      - "Document initial observations and anomalies"
      - "Note system status and user activity"

  - step: 2
    action: "Evidence Preservation"
    details: "Create forensic images and preserve volatile data"
    commands:
      - "mount | grep -E '^/dev/' > mounted_filesystems.txt"
      - "ps auxf > running_processes.txt"
      - "netstat -an > network_connections.txt"
      - "lsof > open_files.txt"
      - "cat /proc/meminfo > memory_info.txt"
    expected_output: "System state documentation before any changes"
    validation: "Verify all volatile data captured successfully"
    critical_note: "DO NOT POWER DOWN SYSTEM until volatile data collected"

  - step: 3
    action: "Memory Dump Acquisition"
    details: "Capture system memory for analysis"
    commands:
      - "lime-forensics-installer"
      - "insmod lime.ko 'path=/tmp/memory.dump format=lime'"
      - "memdump /dev/mem > /tmp/memory.raw"
      - "strings /tmp/memory.dump > /tmp/memory_strings.txt"
    expected_output: "Complete memory dump for forensic analysis"
    validation: "Verify memory dump integrity and completeness"
    storage_requirements: "Ensure sufficient space (equal to system RAM)"
    optional: false

  - step: 4
    action: "Network Traffic Analysis"
    details: "Capture and analyze current network activity"
    commands:
      - "tcpdump -i any -w /tmp/traffic_capture.pcap &"
      - "netstat -tlnp > listening_services.txt"
      - "ss -tuln > socket_statistics.txt"
      - "arp -a > arp_table.txt"
      - "route -n > routing_table.txt"
    expected_output: "Network activity baseline and suspicious connections"
    validation: "Review for unusual connections or data exfiltration"
    duration: "Capture at least 10-15 minutes of traffic"

  - step: 5
    action: "File System Analysis"
    details: "Identify modified files and suspicious artifacts"
    commands:
      - "find /tmp -type f -mtime -1 -ls > recent_tmp_files.txt"
      - "find /var/log -type f -mtime -1 -ls > recent_logs.txt"
      - "find /home -type f -name '.*' -mtime -1 > recent_hidden_files.txt"
      - "find / -type f -perm -4000 -ls 2>/dev/null > suid_files.txt"
      - "lsattr -R / 2>/dev/null | grep -v '^$' > file_attributes.txt"
    expected_output: "File system timeline and suspicious modifications"
    validation: "Compare against known-good baselines if available"
    focus_areas:
      - "Temporary directories (/tmp, /var/tmp)"
      - "Log files (/var/log/*)"
      - "User directories (/home/*)"
      - "System directories (/bin, /sbin, /usr/bin)"
      - "Hidden files and directories"

  - step: 6
    action: "Process and Service Analysis"
    details: "Investigate running processes and suspicious services"
    commands:
      - "ps aux --forest > process_tree.txt"
      - "lsof -p {suspicious_pid} > process_files.txt"
      - "cat /proc/{suspicious_pid}/cmdline"
      - "cat /proc/{suspicious_pid}/environ"
      - "systemctl list-units --type=service > active_services.txt"
    expected_output: "Process hierarchy and resource usage analysis"
    validation: "Cross-reference with known malware signatures"
    red_flags:
      - "Processes with unusual names or locations"
      - "High CPU/memory usage without explanation"
      - "Network connections to suspicious IPs"
      - "Processes running as unexpected users"

  - step: 7
    action: "Log Analysis"
    details: "Review system and application logs for incident indicators"
    commands:
      - "journalctl --since 'yesterday' > system_logs.txt"
      - "cat /var/log/auth.log | grep -i 'failed\\|error\\|invalid' > auth_failures.txt"
      - "cat /var/log/syslog | grep -E '(error|warn|crit)' > system_errors.txt"
      - "lastlog > last_login_info.txt"
      - "cat /var/log/wtmp > login_history.txt"
    expected_output: "Timeline of system events and security-relevant entries"
    validation: "Correlate log entries with incident timeline"
    key_log_locations:
      - "/var/log/auth.log - Authentication events"
      - "/var/log/syslog - General system messages"
      - "/var/log/kern.log - Kernel messages"
      - "/var/log/apache2/ - Web server logs"
      - "/var/log/mail.log - Email server logs"

  - step: 8
    action: "Disk Image Creation"
    details: "Create forensic copies of storage devices"
    commands:
      - "dd if=/dev/sda of=/mnt/evidence/disk_image.dd bs=4M conv=noerror,sync"
      - "md5sum /mnt/evidence/disk_image.dd > /mnt/evidence/disk_image.md5"
      - "sha256sum /mnt/evidence/disk_image.dd > /mnt/evidence/disk_image.sha256"
      - "dcfldd if=/dev/sda of=/mnt/evidence/disk_image.dd bs=4M hash=md5,sha256"
    expected_output: "Bit-for-bit copy of storage devices with integrity hashes"
    validation: "Verify hash values match source device"
    critical_requirements:
      - "Use write-blocking hardware"
      - "Document chain of custody"
      - "Store on separate, secure media"
      - "Create multiple copies if possible"

  - step: 9
    action: "Malware Analysis Preparation"
    details: "Extract and prepare suspicious files for analysis"
    commands:
      - "mkdir /tmp/suspicious_files"
      - "cp {suspicious_file_paths} /tmp/suspicious_files/"
      - "file /tmp/suspicious_files/* > file_types.txt"
      - "md5sum /tmp/suspicious_files/* > suspicious_hashes.md5"
      - "strings /tmp/suspicious_files/* > suspicious_strings.txt"
    expected_output: "Isolated suspicious files ready for detailed analysis"
    validation: "Verify file integrity before analysis"
    safety_note: "Analyze in isolated environment to prevent contamination"

  - step: 10
    action: "Communication and Escalation"
    details: "Report findings and coordinate response actions"
    commands:
      - "echo 'INCIDENT STATUS UPDATE' >> incident_log.txt"
      - "date >> incident_log.txt"
      - "echo 'Key Findings:' >> incident_log.txt"
      - "echo '- Affected systems: {system_list}' >> incident_log.txt"
      - "echo '- Evidence collected: {evidence_summary}' >> incident_log.txt"
    expected_output: "Status report with key findings and recommendations"
    validation: "Confirm all stakeholders receive appropriate information"
    stakeholders:
      - "Incident Commander"
      - "IT Management"
      - "Legal Department"
      - "Law Enforcement (if required)"
      - "Affected Business Units"

decision_points:
  - condition: "System actively under attack"
    if_true: "Isolate system immediately, capture memory first"
    if_false: "Continue with standard evidence collection"
  - condition: "Data exfiltration detected"
    if_true: "Block network access, prioritize network forensics"
    if_false: "Continue with comprehensive analysis"
  - condition: "Multiple systems affected"
    if_true: "Activate full incident response team, coordinate multi-system response"
    if_false: "Focus on single-system investigation"
  - condition: "Legal/regulatory implications"
    if_true: "Involve legal counsel immediately, ensure compliance requirements"
    if_false: "Continue with standard documentation"

quality_checks:
  - "All evidence properly documented with chain of custody"
  - "Hash values calculated and verified for all images"
  - "Timeline of events accurately reconstructed"
  - "No evidence contamination or alteration"
  - "All findings properly correlated and analyzed"
  - "Communication log maintained throughout incident"

common_pitfalls:
  - issue: "Powering down systems before memory capture"
    prevention: "Always capture volatile data first, never power down until complete"
  - issue: "Running analysis tools on compromised system"
    prevention: "Use external tools or live boot media for analysis"
  - issue: "Inadequate chain of custody documentation"
    prevention: "Document every person who handles evidence with timestamps"
  - issue: "Overwriting evidence during investigation"
    prevention: "Work on copies only, never modify original evidence"
  - issue: "Insufficient communication during incident"
    prevention: "Maintain regular status updates to all stakeholders"

containment_strategies:
  - strategy: "Network Isolation"
    description: "Disconnect affected systems from network while preserving evidence"
    commands:
      - "ip link set eth0 down"
      - "iptables -A INPUT -j DROP"
      - "iptables -A OUTPUT -j DROP"
  - strategy: "Process Termination"
    description: "Stop malicious processes while preserving evidence"
    commands:
      - "kill -STOP {malicious_pid}"
      - "gcore {malicious_pid}"
  - strategy: "File System Protection"
    description: "Prevent further file system modifications"
    commands:
      - "mount -o remount,ro /"
      - "chattr +i /critical/files/*"

recovery_planning:
  - "Assess system integrity and determine if rebuild required"
  - "Identify and patch vulnerabilities that enabled incident"
  - "Restore from known-good backups if necessary"
  - "Implement additional monitoring and detection controls"
  - "Conduct lessons learned session"

legal_considerations:
  - "Maintain proper chain of custody documentation"
  - "Comply with data protection and privacy laws"
  - "Consider attorney-client privilege for sensitive communications"
  - "Preserve evidence according to legal retention requirements"
  - "Coordinate with law enforcement if criminal activity suspected"

success_metrics:
  - "Complete evidence collection with integrity preserved"
  - "Accurate timeline reconstruction of incident events"
  - "Successful identification of attack vector and scope"
  - "Proper containment preventing further damage"
  - "Clear documentation supporting potential legal action"

related_workflows:
  - "Network Analysis"
  - "Malware Analysis"
  - "Digital Forensics"
  - "Vulnerability Assessment"
