# AutoBot RAG Agent
# Extends standardized Python agent base image
# Optimized for document processing and retrieval

# Use standardized Python agent base
FROM python-agent-base:latest AS rag-agent

# Agent-specific metadata
LABEL maintainer="AutoBot Team"
LABEL description="AutoBot RAG Agent - Document retrieval and processing"
LABEL agent.type="rag"
LABEL agent.capabilities="document_processing,vector_search,retrieval_augmented_generation"

# RAG agent specific configuration
ENV AGENT_TYPE=rag \
    AGENT_NAME="AutoBot RAG Agent" \
    AGENT_DESCRIPTION="Document retrieval and processing agent" \
    DEFAULT_MODEL_NAME=dolphin-llama3:8b \
    VECTOR_DB_TYPE=chroma \
    CHUNK_SIZE=512 \
    CHUNK_OVERLAP=50 \
    VECTOR_SEARCH_K=5 \
    EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2

# RAG agent specific dependencies
RUN pip install --no-cache-dir \
    chromadb==0.4.15 \
    sentence-transformers==2.2.2 \
    langchain==0.0.335 \
    langchain-community==0.0.8 \
    pypdf2==3.0.1 \
    python-docx==0.8.11 \
    markdown==3.5.1

# Create vector database directory
RUN mkdir -p /app/data/vectors && \
    chown -R ${USER_ID}:${GROUP_ID} /app/data/vectors

# Agent-specific health check
ENV HEALTH_CHECK_PORT=8000
HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \
    CMD curl -f http://localhost:${HEALTH_CHECK_PORT}/health/rag || exit 1

# RAG agent startup command
CMD ["python", "src/agents/rag_agent_server.py"]
