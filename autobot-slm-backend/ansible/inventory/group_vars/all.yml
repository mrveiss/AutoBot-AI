---
# Global variables for all AutoBot VMs

# ==========================================
# AUTOBOT APPLICATION CONFIGURATION
# ==========================================

autobot:
  version: "2.0.0"
  environment: "production"
  domain: "autobot.internal"
  base_dir: "/opt/autobot"
  user: "autobot"
  group: "autobot"
  home_dir: "/home/autobot"

  # Service URLs (internal network)
  services:
    frontend: "http://192.168.100.10"
    backend: "http://192.168.100.20:8001"
    database: "redis://192.168.100.50:6379"
    ai_stack: "http://192.168.100.30:8080"
    npu_worker: "http://192.168.100.40:8081"
    browser: "http://192.168.100.40:3000"

# ==========================================
# NETWORK CONFIGURATION
# ==========================================

network:
  subnet: "192.168.100.0/24"
  gateway: "192.168.100.1"
  dns_servers:
    - "8.8.8.8"
    - "1.1.1.1"
  domain: "autobot.internal"

  # Firewall configuration
  ufw:
    enabled: true
    default_incoming: "deny"
    default_outgoing: "allow"

  # SSH configuration
  ssh:
    port: 22
    permit_root_login: false
    password_authentication: false
    pubkey_authentication: true

# ==========================================
# SYSTEM CONFIGURATION
# ==========================================

system:
  timezone: "Europe/Riga"  # Match main machine timezone (EEST, +0300)
  locale: "en_US.UTF-8"

  # Time synchronization configuration
  time_sync:
    enabled: true
    timezone: "Europe/Riga"  # Main machine timezone
    ntp_servers:
      - "0.lv.pool.ntp.org"
      - "1.lv.pool.ntp.org"
      - "2.lv.pool.ntp.org"
      - "3.lv.pool.ntp.org"
    fallback_servers:
      - "time.google.com"
      - "time.cloudflare.com"
      - "pool.ntp.org"
    monitoring_enabled: true
    force_sync_on_deploy: true

  # Package management
  package_update: true
  package_upgrade: true
  unattended_upgrades: true

  # System users
  users:
    - name: "autobot"
      groups: ["sudo", "docker", "autobot"]
      shell: "/bin/bash"
      create_home: true

  # System directories
  directories:
    - "/opt/autobot"
    - "/var/log/autobot"
    - "/var/lib/autobot"
    - "/etc/autobot"
    - "/opt/autobot/backups"

# ==========================================
# SECURITY CONFIGURATION
# ==========================================

security:
  # SSH hardening
  ssh_hardening:
    disable_root_login: true
    disable_password_auth: true
    change_default_port: false
    fail2ban_enabled: true

  # Firewall rules (common to all VMs)
  firewall_rules:
    # SSH access from gateway
    - rule: allow
      port: 22
      src: "192.168.100.1"
    # Internal network communication
    - rule: allow
      src: "192.168.100.0/24"
    # Health check endpoints
    # TODO Issue #725: Replace broad range with specific ports via SLM config
    - rule: allow
      port: "8000:8099"
      src: "192.168.100.0/24"

# ==========================================
# LOGGING CONFIGURATION
# ==========================================

logging:
  # Log aggregation (centralized on backend VM)
  aggregation:
    enabled: true
    server: "192.168.100.20"
    port: 514
    protocol: "tcp"

  # Log rotation
  rotation:
    enabled: true
    max_size: "100M"
    max_files: 10
    compress: true

  # Log levels
  levels:
    system: "info"
    autobot: "info"
    security: "warning"

# ==========================================
# MONITORING CONFIGURATION
# ==========================================

monitoring:
  enabled: true

  # Health checks
  health_checks:
    enabled: true
    interval: 30
    timeout: 10
    retries: 3

  # Performance monitoring
  performance:
    node_exporter: true
    custom_metrics: true

  # Alerting
  alerts:
    enabled: true
    cpu_threshold: 80
    memory_threshold: 85
    disk_threshold: 90

# ==========================================
# BACKUP CONFIGURATION
# ==========================================

backup:
  enabled: true

  # Backup schedule
  schedule:
    daily: "02:00"
    weekly: "03:00"
    monthly: "04:00"

  # Retention policy
  retention:
    daily: 7
    weekly: 4
    monthly: 12

  # Backup storage
  storage:
    local_path: "/opt/autobot/backups"
    compress: true
    encryption: true

# ==========================================
# SERVICE DEPENDENCIES
# ==========================================

service_dependencies:
  # Define startup order
  startup_order:
    1: ["database"]
    2: ["backend", "aiml"]
    3: ["frontend"]
    4: ["browser"]

  # Health check dependencies
  health_dependencies:
    backend: ["database"]
    frontend: ["backend"]
    aiml: ["database"]
    browser: ["backend"]

# ==========================================
# DEVELOPMENT/DEBUGGING
# ==========================================

debug:
  enabled: false
  log_level: "debug"
  verbose_output: false

# Package repositories
repositories:
  # Add NodeSource for Node.js
  nodejs:
    key_url: "https://deb.nodesource.com/gpgkey/nodesource.gpg.key"
    repo: "deb https://deb.nodesource.com/node_20.x {{ ansible_distribution_release }} main"

  # Add Redis repository
  redis:
    key_url: "https://packages.redis.io/gpg"
    repo: "deb https://packages.redis.io/deb {{ ansible_distribution_release }} main"

  # Add Intel OpenVINO repository (for AI/ML VMs)
  openvino:
    key_url: "https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB"
    repo: "deb https://apt.repos.intel.com/openvino/2024 {{ ansible_distribution_release }} main"
