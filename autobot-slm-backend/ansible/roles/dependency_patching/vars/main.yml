# AutoBot - AI-Powered Automation Platform
# Copyright (c) 2025 mrveiss
# Author: mrveiss
---
# Dependency Patching Role - Variables
# Issue #682: Ansible Rolling Update System for Dependency Patching

# Service definitions per host group
# Maps host groups to their primary service and health endpoints
service_definitions:
  backend:
    service_name: "autobot-backend"
    health_endpoint: "/api/health"
    health_port: 8001
    has_python_venv: true
    venv_path: "/opt/autobot/venv"

  frontend:
    service_name: "autobot-frontend"
    health_endpoint: "/health"
    health_port: 5173
    has_python_venv: false  # Node.js frontend

  aiml:
    service_name: "autobot-aistack"
    health_endpoint: "/health"
    health_port: 8080
    has_python_venv: true
    venv_path: "/opt/autobot/venv"

  npu:
    service_name: "autobot-npu"
    health_endpoint: "/health"
    health_port: 8081
    has_python_venv: true
    venv_path: "/opt/autobot/venv"

  database:
    service_name: "redis-stack-server"
    health_endpoint: null  # Uses redis-cli ping instead
    health_port: 6379
    has_python_venv: false

  browser:
    service_name: "autobot-playwright"
    health_endpoint: "/health"
    health_port: 3000
    has_python_venv: false  # Playwright uses Node.js

# Update order - defines the sequence for rolling updates
# Based on service dependencies: Database -> Backend -> AI -> Frontend -> Browser
update_order:
  - database
  - backend
  - aiml
  - npu
  - frontend
  - browser

# CVE reference mapping for audit trail
cve_references:
  filelock:
    - id: "GHSA-w853-jp5j-5j7f"
      severity: "high"
      description: "TOCTOU race condition symlink attack"
  keras:
    - id: "GHSA-36rr-ww3j-vrjv"
      severity: "high"
      description: "Model loading security bypass"
    - id: "GHSA-cvhh-q5g5-qprp"
      severity: "high"
      description: "Model loading security bypass"
    - id: "GHSA-mq84-hjqx-cwf2"
      severity: "medium"
      description: "Model loading vulnerability"
    - id: "GHSA-hjqc-jx6g-rwp9"
      severity: "medium"
      description: "Model loading vulnerability"
  langchain-core:
    - id: "GHSA-6qv9-48xg-fc7f"
      severity: "medium"
      description: "Input validation issue"
    - id: "GHSA-c67j-w6g6-q2cm"
      severity: "medium"
      description: "Input validation issue"
  markdownify:
    - id: "GHSA-7mpr-5m44-h73r"
      severity: "medium"
      description: "XSS vulnerability"
  marshmallow:
    - id: "GHSA-428g-f7cq-pgp5"
      severity: "low"
      description: "Deserialization issue"
  pypdf:
    - id: "GHSA-vr63-x8vc-m265"
      severity: "medium"
      description: "PDF parsing vulnerability"
    - id: "GHSA-jfx9-29x2-rv3j"
      severity: "medium"
      description: "PDF parsing vulnerability"
    - id: "GHSA-m449-cwjh-6pw7"
      severity: "medium"
      description: "PDF parsing vulnerability"
  starlette:
    - id: "GHSA-7f5h-v6xp-fcq8"
      severity: "medium"
      description: "Request handling vulnerability"
  urllib3:
    - id: "GHSA-gm62-xv2j-4w53"
      severity: "medium"
      description: "HTTP handling issue"
    - id: "GHSA-2xpw-w6gg-jr37"
      severity: "medium"
      description: "HTTP handling issue"
  werkzeug:
    - id: "GHSA-hgf8-39gv-g3f2"
      severity: "medium"
      description: "Request handling vulnerability"
  requests:
    - id: "GHSA-9wx4-h78v-vm56"
      severity: "medium"
      description: "HTTP handling issue"
    - id: "GHSA-9hjg-9r4m-mvj7"
      severity: "medium"
      description: "HTTP handling issue"
