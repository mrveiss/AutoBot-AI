#!/bin/bash
# AutoBot - AI-Powered Automation Platform
# Copyright (c) 2025 mrveiss
# Author: mrveiss
#
# Refresh DNS configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

set -e

echo "ðŸ”„ Refreshing AutoBot DNS configuration..."

{% if install_dnsmasq %}
# Restart dnsmasq
echo "ðŸ“‹ Restarting dnsmasq..."
sudo systemctl restart dnsmasq
sudo systemctl status dnsmasq --no-pager -l
{% elif use_systemd_resolved %}
# Restart systemd-resolved
echo "ðŸ“‹ Restarting systemd-resolved..."
sudo systemctl restart systemd-resolved
sudo systemctl status systemd-resolved --no-pager -l
{% endif %}

# Flush DNS cache
echo "ðŸ§¹ Flushing DNS cache..."
{% if install_dnsmasq %}
sudo pkill -HUP dnsmasq
{% elif use_systemd_resolved %}
sudo resolvectl flush-caches
{% else %}
# No cache to flush
echo "No DNS cache configured"
{% endif %}

# Test resolution
echo ""
echo "ðŸ§ª Testing DNS resolution..."
/opt/autobot/scripts/dns/test-dns-resolution.sh

echo ""
echo "âœ… DNS configuration refreshed"
