# AutoBot dnsmasq Configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

# Listen only on localhost
listen-address={{ dnsmasq_listen_address }}
bind-interfaces

# DNS port
port={{ dnsmasq_port }}

# Cache settings
cache-size={{ dnsmasq_cache_size }}
no-negcache

# Domain settings
domain={{ dns_domain }}
{% for search_domain in dns_search_domains %}
domain={{ search_domain }}
{% endfor %}

# Read /etc/hosts
no-hosts
addn-hosts=/etc/hosts

# Log queries (comment out in production)
# log-queries
# log-facility=/var/log/dnsmasq.log

# DNSSEC (disabled by default)
# dnssec

# Upstream DNS servers
{% if systemd_resolved_fallback_dns | length > 0 %}
{% for dns_server in systemd_resolved_fallback_dns %}
server={{ dns_server }}
{% endfor %}
{% else %}
# Use system DNS
no-resolv
{% endif %}

# Local domain resolution
local=/{{ dns_domain }}/
{% for search_domain in dns_search_domains %}
local=/{{ search_domain }}/
{% endfor %}

# Expand simple hostnames
expand-hosts

# Don't forward reverse lookups for private IP ranges
bogus-priv

# Reject private addresses from upstream nameservers
stop-dns-rebind
rebind-localhost-ok
