#!/bin/bash
# AutoBot - AI-Powered Automation Platform
# Copyright (c) 2025 mrveiss
# Author: mrveiss
#
# Check health of all distributed AutoBot services
# Generated by Ansible - DO NOT EDIT MANUALLY

set -e

# Load environment
[ -f "{{ config_dir }}/distributed/environment.env" ] && source "{{ config_dir }}/distributed/environment.env"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo "AutoBot Distributed Services Health Check"
echo "=========================================="
echo ""

# Check coordinator
echo -n "Checking Backend Coordinator ({{ coordinator_host }}:{{ backend_port }})... "
if curl -s --max-time 5 "http://{{ coordinator_host }}:{{ backend_port }}/api/health" >/dev/null 2>&1; then
    echo -e "${GREEN}OK${NC}"
else
    echo -e "${RED}Failed${NC}"
fi

# Check each fleet node
{% for node in fleet_nodes %}
echo -n "Checking {{ node.name }} ({{ node.host }}:{{ node.port }})... "
if curl -s --max-time 5 "http://{{ node.host }}:{{ node.port }}{{ node.health_endpoint }}" >/dev/null 2>&1; then
    echo -e "${GREEN}OK${NC}"
elif nc -z -w3 "{{ node.host }}" "{{ node.port }}" 2>/dev/null; then
    echo -e "${YELLOW}Port open but no HTTP response${NC}"
else
    echo -e "${RED}Failed${NC}"
fi
{% endfor %}

echo ""
echo "Service URLs:"
echo "  Backend API: http://{{ coordinator_host }}:{{ backend_port }}"
{% for node in fleet_nodes %}
echo "  {{ node.name }}: http://{{ node.host }}:{{ node.port }}"
{% endfor %}
