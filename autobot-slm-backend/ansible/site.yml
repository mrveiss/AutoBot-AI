---
# AutoBot Main Deployment Playbook
- name: Deploy AutoBot Infrastructure
  hosts: all
  become: yes
  gather_facts: yes

  pre_tasks:
    - name: Update system packages
      apt:
        update_cache: yes
        upgrade: dist
      tags: ['system', 'update']

    - name: Install common packages
      apt:
        name:
          - curl
          - wget
          - git
          - htop
          - vim
          - unzip
          - software-properties-common
        state: present
      tags: ['system', 'packages']

  roles:
    - common
    - network
    - security
    - time_sync

# Frontend VMs
- name: Deploy Frontend Services
  hosts: frontend
  become: yes
  roles:
    - nodejs
    - nginx
    - frontend_app
  tags: ['frontend']

# Backend VMs
- name: Deploy Backend Services
  hosts: backend
  become: yes
  roles:
    - python
    - fastapi_app
    - backend_services
  tags: ['backend']

# AI Stack VMs
- name: Deploy AI Services
  hosts: ai_stack
  become: yes
  roles:
    - python
    - cuda_drivers
    - ai_models
    - ai_services
  tags: ['ai']

# NPU Worker VMs
- name: Deploy NPU Services
  hosts: npu_workers
  become: yes
  roles:
    - python
    - intel_npu
    - npu_services
  tags: ['npu']

# Database VMs
- name: Deploy Database Services
  hosts: database
  become: yes
  roles:
    - redis_stack
    - data_backup
  tags: ['database']

# Final configuration
- name: Configure Service Communication
  hosts: autobot_cluster
  become: yes
  tasks:
    - name: Generate service discovery configuration
      template:
        src: service_discovery.j2
        dest: /etc/autobot/services.yml
      notify: restart_services
  tags: ['config']
