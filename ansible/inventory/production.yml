---
# AutoBot Production Inventory - Hyper-V VMs
# Update the ansible_host IPs with your actual VM addresses

all:
  vars:
    # Global SSH and connection settings - UPDATED FOR PROVIDED VMs
    # Issue #700: SSH key authentication (no plaintext passwords)
    ansible_user: autobot
    ansible_ssh_private_key_file: ~/.ssh/autobot_key
    ansible_become: yes
    # Become password from vault (only needed if passwordless sudo not configured)
    # To use: ansible-playbook ... --ask-vault-pass
    # ansible_become_password: "{{ vault_become_password_autobot }}"
    ansible_ssh_common_args: '-o StrictHostKeyChecking=accept-new'
    ansible_python_interpreter: /usr/bin/python3
    
    # Global network configuration - UPDATED FOR 172.16.168.x SUBNET
    network_subnet: "172.16.168.0/24"
    network_gateway: "172.16.168.1"
    dns_servers:
      - "8.8.8.8"
      - "1.1.1.1"
    
    # Global AutoBot configuration
    autobot_domain: "autobot.internal"
    autobot_environment: "production"
    autobot_version: "2.0.0"
    
    # Service discovery endpoints - UPDATED FOR PROVIDED VMs
    redis_host: "172.16.168.23"      # Database VM
    redis_port: 6379
    backend_host: "172.16.168.20"    # Backend WSL
    backend_port: 8001
    ai_stack_host: "172.16.168.24"   # AI Stack VM
    ai_stack_port: 8080
    npu_worker_host: "172.16.168.22" # NPU Worker VM (dedicated)
    npu_worker_port: 8081
    
  children:
    frontend:
      hosts:
        autobot-frontend:
          ansible_host: 172.16.168.21  # Frontend VM
          vm_id: "autobot-frontend-vm"
          vm_role: "frontend"
          vm_hostname: "autobot-frontend"
          vm_resources:
            ram_mb: 4096     # Test config - dynamic memory
            cpu_cores: 2
            disk_gb: 50      # LVM expansion target
          services:
            - nginx
            - nodejs
            - vue-frontend
            - dns-cache
      vars:
        # Frontend-specific configuration
        frontend_port: 5173
        nginx_port: 80
        nginx_ssl_port: 443
        nodejs_version: "20"
        vue_build_mode: "production"
        
    backend:
      hosts:
        autobot-host:
          ansible_connection: local    # This is the local WSL machine
          ansible_host: 127.0.0.1      # Local connection
          ansible_become: no           # Issue #700: Disable become for local host by default
          # Enable become when needed with: --extra-vars "ansible_become=yes"
          # Or use: --ask-become-pass for operations requiring sudo
          vm_id: "autobot-wsl-machine"
          vm_role: "wsl-host"
          vm_hostname: "autobot-host"
          services:
            - fastapi-backend
            - terminal-service
            - novnc-service
            - python3
            - desktop-access
      vars:
        # WSL machine configuration (local)
        backend_port: 8001
        terminal_port: 7681
        novnc_port: 6080
        vnc_port: 5900
        python_version: "3.10"
        fastapi_workers: 4
        log_level: "INFO"
        
    npu:
      hosts:
        autobot-npu:
          ansible_host: 172.16.168.22  # NPU Worker VM
          vm_id: "autobot-npu-vm"
          vm_role: "npu"
          vm_hostname: "autobot-npu"
          vm_resources:
            ram_mb: 8192     # Test config - dynamic memory
            cpu_cores: 4
            disk_gb: 50      # LVM expansion target
          services:
            - npu-worker
            - openvino
            - python3
            - hardware-acceleration
          hardware_features:
            npu_access: true
            gpu_passthrough: true
            pci_passthrough: true
            hardware_acceleration: true
      vars:
        # NPU Worker-specific configuration
        npu_worker_port: 8081
        openvino_device: "AUTO"  # Auto-detect NPU > GPU > CPU
        python_version: "3.11"
        worker_threads: 2
        inference_optimization: true
        # Hardware access configuration
        enable_npu_passthrough: true
        enable_gpu_passthrough: true
        npu_device_path: "/dev/accel"
        gpu_device_path: "/dev/dri"
        
    database:
      hosts:
        autobot-database:
          ansible_host: 172.16.168.23  # Database VM
          vm_id: "autobot-database-vm"
          vm_role: "database"
          vm_hostname: "autobot-database"
          vm_resources:
            ram_mb: 8192     # Test config - dynamic memory
            cpu_cores: 2
            disk_gb: 50      # LVM expansion target
          services:
            - redis-stack
            - model-storage
            - backup-service
      vars:
        # Database-specific configuration
        redis_port: 6379
        redis_insight_port: 8002
        redis_memory_limit: "6gb"
        redis_persistence: true
        backup_retention_days: 30
        
    aiml:
      hosts:
        autobot-aiml:
          ansible_host: 172.16.168.24  # AI/ML VM
          vm_id: "autobot-aiml-vm"
          vm_role: "aiml"
          vm_hostname: "autobot-aiml"
          vm_resources:
            ram_mb: 16384    # Test config - dynamic memory
            cpu_cores: 6
            disk_gb: 50      # LVM expansion target
          services:
            - ai-stack
            - ollama
            - model-server
          hardware_features:
            gpu_passthrough: true
      vars:
        # AI/ML-specific configuration  
        ai_stack_port: 8080
        ollama_port: 11434
        model_cache_size: "10gb"
        inference_threads: 4
        
    browser:
      hosts:
        autobot-browser:
          ansible_host: 172.16.168.25  # Browser VM
          vm_id: "autobot-browser-vm"
          vm_role: "browser"
          vm_hostname: "autobot-browser"
          vm_resources:
            ram_mb: 4096     # Test config - dynamic memory
            cpu_cores: 2
            disk_gb: 50      # LVM expansion target
          services:
            - playwright
            - vnc-server
            - desktop-environment
            - browser-automation
          desktop_features:
            vnc_enabled: true
            desktop_environment: "xfce4"
      vars:
        # Browser-specific configuration
        playwright_port: 3000
        vnc_port: 5901
        vnc_display: ":1"
        browser_timeout: 30
        headless_mode: false

# Environment-specific groups
production_vms:
  children:
    frontend:
    npu:
    database:
    aiml:
    browser:
  vars:
    environment_type: "production"
    monitoring_enabled: true
    backup_enabled: true
    security_hardening: true

# Host machine group (not a VM)
production_host:
  children:
    backend:
  vars:
    environment_type: "production"
    host_machine: true

# Service-type groups for cross-VM operations
web_services:
  children:
    frontend:
    backend:
  vars:
    web_server_type: "nginx"
    ssl_enabled: true

data_services:
  children:
    database:
    aiml:
  vars:
    data_persistence: true
    backup_strategy: "incremental"

compute_services:
  children:
    backend:
    aiml:
    browser:
  vars:
    performance_monitoring: true
    resource_alerts: true