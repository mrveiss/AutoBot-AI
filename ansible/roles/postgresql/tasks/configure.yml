# AutoBot - AI-Powered Automation Platform
# Copyright (c) 2025 mrveiss
# Author: mrveiss
#
# PostgreSQL Configuration Tasks
---

- name: Create credentials directory
  ansible.builtin.file:
    path: "{{ postgresql_credentials_dir }}"
    state: directory
    owner: "{{ autobot_user }}"
    group: "{{ autobot_group }}"
    mode: '0750'
  become: true

- name: Deploy postgresql.conf
  ansible.builtin.template:
    src: postgresql.conf.j2
    dest: "{{ postgresql_config_dir }}/postgresql.conf"
    owner: postgres
    group: postgres
    mode: '0644'
    backup: true
  become: true
  notify: Restart PostgreSQL

- name: Deploy pg_hba.conf
  ansible.builtin.template:
    src: pg_hba.conf.j2
    dest: "{{ postgresql_config_dir }}/pg_hba.conf"
    owner: postgres
    group: postgres
    mode: '0640'
    backup: true
  become: true
  notify: Reload PostgreSQL

- name: Flush handlers to apply configuration
  ansible.builtin.meta: flush_handlers
