# AutoBot - AI-Powered Automation Platform
# Copyright (c) 2025 mrveiss
# Author: mrveiss
#
# SLM Agent Configuration
# Managed by Ansible - do not edit manually
# Node: {{ slm_node_id }}
# Generated: {{ ansible_date_time.iso8601 }}
#
# Auto-detect if agent runs on same host as SLM backend - use localhost if so
{% set admin_host = slm_admin_url | regex_replace('^https?://([^:/]+).*$', '\\1') %}
{% if admin_host == ansible_host or admin_host == inventory_hostname %}
{% set effective_admin_url = slm_admin_url | regex_replace(admin_host, '127.0.0.1') %}
{% else %}
{% set effective_admin_url = slm_admin_url %}
{% endif %}
---

# Node identification
node_id: "{{ slm_node_id }}"
hostname: "{{ inventory_hostname }}"

# Admin connectivity
admin_url: "{{ effective_admin_url }}"
heartbeat_interval: {{ slm_heartbeat_interval }}

# Local data storage
data_dir: "{{ slm_agent_data_dir }}"
buffer_db: "{{ slm_agent_data_dir }}/events.db"

# Logging
log_level: "{{ slm_agent_log_level }}"
debug: {{ slm_agent_debug | lower }}

# Services to monitor (systemd service names)
services:
{% if slm_services_to_monitor | length > 0 %}
{% for service in slm_services_to_monitor %}
  - {{ service }}
{% endfor %}
{% else %}
  []
{% endif %}

# Port connectivity checks
ports:
{% if slm_ports_to_check | length > 0 %}
{% for port_check in slm_ports_to_check %}
  - host: "{{ port_check.host | default('localhost') }}"
    port: {{ port_check.port }}
{% endfor %}
{% else %}
  []
{% endif %}

# Health thresholds (for local alerting)
thresholds:
  cpu_percent: 90
  memory_percent: 90
  disk_percent: 90
