<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoBot Frontend Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .loading { background-color: #fff3cd; border: 1px solid #ffeaa7; }
        iframe { width: 100%; height: 600px; border: 1px solid #ccc; }
        .test-results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>AutoBot Frontend Final Test</h1>

    <div id="status" class="status loading">
        Testing frontend accessibility...
    </div>

    <h2>Frontend Preview</h2>
    <iframe id="frontend-iframe" src="http://172.16.168.21:5173"></iframe>

    <div class="test-results">
        <h2>Test Results</h2>
        <div id="test-results">
            <p>Loading tests...</p>
        </div>
    </div>

    <script>
        async function testFrontend() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('test-results');

            try {
                statusDiv.textContent = 'Testing frontend server...';

                // Test 1: Check if frontend is accessible
                const frontendResponse = await fetch('http://172.16.168.21:5173');
                const frontendText = await frontendResponse.text();

                let results = '<h3>Frontend Server Tests</h3>';

                if (frontendResponse.ok) {
                    results += '<p>✅ Frontend server is accessible</p>';

                    if (frontendText.includes('<!DOCTYPE html>')) {
                        results += '<p>✅ HTML document served correctly</p>';
                    } else {
                        results += '<p>❌ HTML document not found</p>';
                    }

                    if (frontendText.includes('<div id="app">')) {
                        results += '<p>✅ Vue app mount point found</p>';
                    } else {
                        results += '<p>❌ Vue app mount point missing</p>';
                    }

                    if (frontendText.includes('main.ts')) {
                        results += '<p>✅ TypeScript entry point referenced</p>';
                    } else {
                        results += '<p>❌ TypeScript entry point missing</p>';
                    }
                } else {
                    results += '<p>❌ Frontend server not accessible</p>';
                }

                // Test 2: Check backend
                results += '<h3>Backend API Tests</h3>';
                try {
                    const backendResponse = await fetch('http://172.16.168.20:8001/api/advanced-control/system/health');
                    if (backendResponse.ok) {
                        const backendData = await backendResponse.json();
                        results += '<p>✅ Backend API is accessible</p>';
                        results += `<p>✅ System status: ${backendData.status}</p>`;
                    } else {
                        results += '<p>❌ Backend API not accessible</p>';
                    }
                } catch (e) {
                    results += '<p>❌ Backend API connection failed</p>';
                }

                resultsDiv.innerHTML = results;
                statusDiv.textContent = 'Test completed!';
                statusDiv.className = 'status success';

                // Check iframe loading
                const iframe = document.getElementById('frontend-iframe');
                iframe.onload = function() {
                    console.log('Frontend iframe loaded successfully');
                };

                iframe.onerror = function() {
                    console.log('Frontend iframe failed to load');
                };

            } catch (error) {
                statusDiv.textContent = 'Test failed: ' + error.message;
                statusDiv.className = 'status error';
                resultsDiv.innerHTML = `<p>❌ Test error: ${error.message}</p>`;
            }
        }

        // Run test when page loads
        window.addEventListener('load', testFrontend);
    </script>
</body>
</html>