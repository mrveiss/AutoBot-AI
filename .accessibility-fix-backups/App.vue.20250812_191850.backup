<template>
  <div class="min-h-screen bg-blueGray-50">
    <!-- Top Brand Bar -->
    <nav class="bg-white shadow-lg flex flex-wrap items-center justify-between w-full z-[9998] relative py-4 px-6">
      <div class="flex flex-row items-center justify-between w-full mx-auto">
        <!-- Brand -->
        <div class="flex items-center flex-shrink-0">
          <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-indigo-700 rounded-full flex items-center justify-center shadow-lg">
            <span class="text-white text-xl font-bold">A</span>
          </div>
          <span class="ml-3 text-xl font-semibold text-blueGray-700">AutoBot Pro</span>
        </div>

        <!-- Mobile menu button and dropdown container -->
        <div class="relative" ref="mobileMenuContainer">
          <button
            class="cursor-pointer text-black opacity-50 md:hidden px-3 py-1 text-xl leading-none bg-transparent rounded border border-solid border-transparent"
            type="button"
            @click="toggleNavbar"
          >
            <i class="fas fa-bars" :class="navbarOpen ? 'fa-times' : 'fa-bars'"></i>
          </button>

          <!-- Mobile Navigation Menu -->
          <div
            v-if="navbarOpen"
            class="md:hidden fixed top-16 right-4 z-[99999] w-64"
            @click.stop
          >
            <div class="mt-2 bg-white rounded-lg p-4 shadow-xl border border-blueGray-200" style="box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);">
              <ul class="flex flex-col space-y-2">
                <li>
                  <a
                    @click="updateRoute('dashboard')"
                    :class="[activeTab === 'dashboard' ? 'text-indigo-600 bg-indigo-100' : 'text-blueGray-700 hover:text-indigo-600 hover:bg-indigo-50']"
                    class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150 w-full"
                  >
                    <i class="fas fa-tachometer-alt mr-2 text-sm"></i>
                    Dashboard
                  </a>
                </li>
                <li>
                  <a
                    @click="updateRoute('chat')"
                    :class="[activeTab === 'chat' ? 'text-indigo-600 bg-indigo-100' : 'text-blueGray-700 hover:text-indigo-600 hover:bg-indigo-50']"
                    class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150 w-full"
                  >
                    <i class="fas fa-comments mr-2 text-sm"></i>
                    AI Assistant
                  </a>
                </li>
                <li>
                  <a
                    @click="updateRoute('voice')"
                    :class="[activeTab === 'voice' ? 'text-indigo-600 bg-indigo-100' : 'text-blueGray-700 hover:text-indigo-600 hover:bg-indigo-50']"
                    class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150 w-full"
                  >
                    <i class="fas fa-microphone mr-2 text-sm"></i>
                    Voice Interface
                  </a>
                </li>
                <li>
                  <a
                    @click="updateRoute('knowledge')"
                    :class="[activeTab === 'knowledge' ? 'text-indigo-600 bg-indigo-100' : 'text-blueGray-700 hover:text-indigo-600 hover:bg-indigo-50']"
                    class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150 w-full"
                  >
                    <i class="fas fa-brain mr-2 text-sm"></i>
                    Knowledge Base
                  </a>
                </li>
                <li>
                  <a
                    @click="updateRoute('terminal')"
                    :class="[activeTab === 'terminal' ? 'text-indigo-600 bg-indigo-100' : 'text-blueGray-700 hover:text-indigo-600 hover:bg-indigo-50']"
                    class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150 w-full"
                  >
                    <i class="fas fa-terminal mr-2 text-sm"></i>
                    Terminal
                  </a>
                </li>
                <li>
                  <a
                    @click="updateRoute('files')"
                    :class="[activeTab === 'files' ? 'text-indigo-600 bg-indigo-100' : 'text-blueGray-700 hover:text-indigo-600 hover:bg-indigo-50']"
                    class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150 w-full"
                  >
                    <i class="fas fa-folder mr-2 text-sm"></i>
                    File Manager
                  </a>
                </li>
                <li>
                  <a
                    @click="updateRoute('monitor')"
                    :class="[activeTab === 'monitor' ? 'text-indigo-600 bg-indigo-100' : 'text-blueGray-700 hover:text-indigo-600 hover:bg-indigo-50']"
                    class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150 w-full"
                  >
                    <i class="fas fa-chart-line mr-2 text-sm"></i>
                    System Monitor
                  </a>
                </li>
                <li>
                  <a
                    @click="updateRoute('workflows')"
                    :class="[activeTab === 'workflows' ? 'text-indigo-600 bg-indigo-100' : 'text-blueGray-700 hover:text-indigo-600 hover:bg-indigo-50']"
                    class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150 w-full"
                  >
                    <i class="fas fa-project-diagram mr-2 text-sm"></i>
                    Workflows
                  </a>
                </li>
                <li>
                  <a
                    @click="updateRoute('settings')"
                    :class="[activeTab === 'settings' ? 'text-indigo-600 bg-indigo-100' : 'text-blueGray-700 hover:text-indigo-600 hover:bg-indigo-50']"
                    class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150 w-full"
                  >
                    <i class="fas fa-cog mr-2 text-sm"></i>
                    Settings
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- User menu (Right) -->
        <div class="flex items-center flex-shrink-0">
          <a class="text-blueGray-600 hover:text-blueGray-800 px-3 py-2 flex items-center text-xs uppercase font-bold">
            <i class="fas fa-user-circle text-lg mr-2"></i>
            Admin User
          </a>
        </div>
      </div>
    </nav>

    <!-- Main content -->
    <div class="relative bg-blueGray-50" :class="activeTab === 'chat' ? 'h-screen flex flex-col' : 'min-h-screen'">

      <!-- Header gradient with navigation -->
      <div class="relative bg-gradient-to-br from-indigo-600 to-indigo-800 md:pt-4 pb-4 pt-2 z-40">
        <div class="px-4 md:px-10 mx-auto w-full">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <!-- Page heading removed - tab name already shown in navigation -->

            <!-- Navigation Links -->
            <div class="flex items-center relative">
              <!-- Desktop Navigation -->
              <div class="hidden md:flex">
                <ul class="flex flex-row list-none space-x-1">
                  <li>
                    <a
                      @click="updateRoute('dashboard')"
                      :class="[activeTab === 'dashboard' ? 'text-white bg-indigo-500' : 'text-indigo-200 hover:text-white hover:bg-white hover:bg-opacity-10']"
                      class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150"
                    >
                      <i class="fas fa-tachometer-alt mr-2 text-sm"></i>
                      Dashboard
                    </a>
                  </li>
                  <li>
                    <a
                      @click="updateRoute('chat')"
                      :class="[activeTab === 'chat' ? 'text-white bg-indigo-500' : 'text-indigo-200 hover:text-white hover:bg-white hover:bg-opacity-10']"
                      class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150"
                    >
                      <i class="fas fa-comments mr-2 text-sm"></i>
                      AI Assistant
                    </a>
                  </li>
                  <li>
                    <a
                      @click="updateRoute('voice')"
                      :class="[activeTab === 'voice' ? 'text-white bg-indigo-500' : 'text-indigo-200 hover:text-white hover:bg-white hover:bg-opacity-10']"
                      class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150"
                    >
                      <i class="fas fa-microphone mr-2 text-sm"></i>
                      Voice Interface
                    </a>
                  </li>
                  <li>
                    <a
                      @click="updateRoute('knowledge')"
                      :class="[activeTab === 'knowledge' ? 'text-white bg-indigo-500' : 'text-indigo-200 hover:text-white hover:bg-white hover:bg-opacity-10']"
                      class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150"
                    >
                      <i class="fas fa-brain mr-2 text-sm"></i>
                      Knowledge Base
                    </a>
                  </li>
                  <li>
                    <a
                      @click="updateRoute('terminal')"
                      :class="[activeTab === 'terminal' ? 'text-white bg-indigo-500' : 'text-indigo-200 hover:text-white hover:bg-white hover:bg-opacity-10']"
                      class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150"
                    >
                      <i class="fas fa-terminal mr-2 text-sm"></i>
                      Terminal
                    </a>
                  </li>
                  <li>
                    <a
                      @click="updateRoute('files')"
                      :class="[activeTab === 'files' ? 'text-white bg-indigo-500' : 'text-indigo-200 hover:text-white hover:bg-white hover:bg-opacity-10']"
                      class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150"
                    >
                      <i class="fas fa-folder mr-2 text-sm"></i>
                      File Manager
                    </a>
                  </li>
                  <li>
                    <a
                      @click="updateRoute('monitor')"
                      :class="[activeTab === 'monitor' ? 'text-white bg-indigo-500' : 'text-indigo-200 hover:text-white hover:bg-white hover:bg-opacity-10']"
                      class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150"
                    >
                      <i class="fas fa-chart-line mr-2 text-sm"></i>
                      System Monitor
                    </a>
                  </li>
                  <li>
                    <a
                      @click="updateRoute('workflows')"
                      :class="[activeTab === 'workflows' ? 'text-white bg-indigo-500' : 'text-indigo-200 hover:text-white hover:bg-white hover:bg-opacity-10']"
                      class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150"
                    >
                      <i class="fas fa-project-diagram mr-2 text-sm"></i>
                      Workflows
                    </a>
                  </li>
                  <li>
                    <a
                      @click="updateRoute('settings')"
                      :class="[activeTab === 'settings' ? 'text-white bg-indigo-500' : 'text-indigo-200 hover:text-white hover:bg-white hover:bg-opacity-10']"
                      class="text-xs uppercase py-2 px-3 font-bold inline-flex items-center rounded-lg cursor-pointer transition-all duration-150"
                    >
                      <i class="fas fa-cog mr-2 text-sm"></i>
                      Settings
                    </a>
                  </li>
                </ul>
              </div>

            </div>
          </div>
        </div>
      </div>


      <!-- Content area -->
      <div class="px-4 md:px-10 mx-auto w-full" :class="activeTab === 'dashboard' ? 'mt-0' : (activeTab === 'chat' ? 'flex-1 flex flex-col' : 'mt-4')">
        <div class="flex flex-wrap" :class="activeTab === 'chat' ? 'flex-1 h-full' : 'mt-4'">
          <div class="w-full px-4" :class="activeTab === 'chat' ? 'flex-1 h-full flex flex-col' : 'mb-12'">
            <!-- Remove Transition for debugging -->
            <div>
              <!-- Dashboard View -->
              <div v-if="activeTab === 'dashboard'" key="dashboard">
                <!-- Phase Status Indicator -->
                <div class="w-full mb-6">
                  <PhaseStatusIndicator />
                </div>

                <div class="relative flex flex-col min-w-0 break-words w-full mb-6 shadow-lg rounded-lg bg-white">
                  <div class="rounded-t mb-0 px-6 py-6">
                    <div class="text-center flex justify-between">
                      <h6 class="text-blueGray-700 text-xl font-bold">System Overview</h6>
                      <button class="bg-indigo-500 text-white active:bg-indigo-600 text-xs font-bold uppercase px-3 py-1 rounded outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150" type="button">
                        <i class="fas fa-sync mr-1"></i> Refresh
                      </button>
                    </div>
                  </div>
                  <div class="flex-auto px-6 py-6">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-blueGray-50 rounded-lg p-6">
                      <h3 class="text-lg font-semibold text-blueGray-700 mb-4">Recent Activity</h3>
                      <div class="space-y-3">
                        <div class="flex items-center">
                          <div class="w-2 h-2 bg-emerald-500 rounded-full mr-3"></div>
                          <span class="text-sm text-blueGray-600">New knowledge item added</span>
                          <span class="ml-auto text-xs text-blueGray-400">2 min ago</span>
                        </div>
                        <div class="flex items-center">
                          <div class="w-2 h-2 bg-lightBlue-500 rounded-full mr-3"></div>
                          <span class="text-sm text-blueGray-600">Voice command processed</span>
                          <span class="ml-auto text-xs text-blueGray-400">5 min ago</span>
                        </div>
                        <div class="flex items-center">
                          <div class="w-2 h-2 bg-orange-500 rounded-full mr-3"></div>
                          <span class="text-sm text-blueGray-600">File uploaded successfully</span>
                          <span class="ml-auto text-xs text-blueGray-400">12 min ago</span>
                        </div>
                      </div>
                    </div>
                    <div class="bg-blueGray-50 rounded-lg p-6">
                      <h3 class="text-lg font-semibold text-blueGray-700 mb-4">Quick Actions</h3>
                      <div class="grid grid-cols-2 gap-3">
                        <button @click="updateRoute('chat')" class="btn btn-primary text-sm">
                          <i class="fas fa-comments mr-2"></i>
                          New Chat
                        </button>
                        <button @click="updateRoute('knowledge')" class="btn btn-secondary text-sm">
                          <i class="fas fa-plus mr-2"></i>
                          Add Knowledge
                        </button>
                        <button @click="updateRoute('files')" class="btn btn-success text-sm">
                          <i class="fas fa-upload mr-2"></i>
                          Upload File
                        </button>
                        <button @click="updateRoute('terminal')" class="btn btn-outline text-sm">
                          <i class="fas fa-terminal mr-2"></i>
                          Terminal
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Stats Cards Section -->
                  <div class="mt-6">
                    <h3 class="text-lg font-semibold text-blueGray-700 mb-4 px-6">System Statistics</h3>
                    <div class="grid grid-cols-2 gap-4 px-8">
                      <!-- Active Sessions Card -->
                      <div class="relative flex flex-col min-w-0 break-words bg-blueGray-50 rounded-lg shadow-sm">
                        <div class="flex-auto p-3">
                          <div class="flex flex-wrap">
                            <div class="relative w-full pr-4 max-w-full flex-grow flex-1">
                              <h5 class="text-blueGray-400 uppercase font-bold text-xs">Active Sessions</h5>
                              <span class="font-semibold text-xl text-blueGray-700">{{ activeSessions }}</span>
                            </div>
                            <div class="relative w-auto pl-4 flex-initial">
                              <div class="text-white p-3 text-center inline-flex items-center justify-center w-12 h-12 shadow-lg rounded-full bg-red-500">
                                <i class="fas fa-users"></i>
                              </div>
                            </div>
                          </div>
                          <p class="text-sm text-blueGray-400 mt-4">
                            <span class="text-emerald-500 mr-2">
                              <i class="fas fa-arrow-up"></i> 3.48%
                            </span>
                            <span class="whitespace-nowrap">Since last month</span>
                          </p>
                        </div>
                      </div>

                      <!-- Knowledge Items Card -->
                      <div class="relative flex flex-col min-w-0 break-words bg-blueGray-50 rounded-lg shadow-sm">
                        <div class="flex-auto p-3">
                          <div class="flex flex-wrap">
                            <div class="relative w-full pr-4 max-w-full flex-grow flex-1">
                              <h5 class="text-blueGray-400 uppercase font-bold text-xs">Knowledge Items</h5>
                              <span class="font-semibold text-xl text-blueGray-700">{{ knowledgeItems }}</span>
                            </div>
                            <div class="relative w-auto pl-4 flex-initial">
                              <div class="text-white p-3 text-center inline-flex items-center justify-center w-12 h-12 shadow-lg rounded-full bg-orange-500">
                                <i class="fas fa-database"></i>
                              </div>
                            </div>
                          </div>
                          <p class="text-sm text-blueGray-400 mt-4">
                            <span class="text-emerald-500 mr-2">
                              <i class="fas fa-arrow-up"></i> 12%
                            </span>
                            <span class="whitespace-nowrap">Since last week</span>
                          </p>
                        </div>
                      </div>

                      <!-- Tasks Completed Card -->
                      <div class="relative flex flex-col min-w-0 break-words bg-blueGray-50 rounded-lg shadow-sm">
                        <div class="flex-auto p-3">
                          <div class="flex flex-wrap">
                            <div class="relative w-full pr-4 max-w-full flex-grow flex-1">
                              <h5 class="text-blueGray-400 uppercase font-bold text-xs">Tasks Completed</h5>
                              <span class="font-semibold text-xl text-blueGray-700">{{ tasksCompleted }}</span>
                            </div>
                            <div class="relative w-auto pl-4 flex-initial">
                              <div class="text-white p-3 text-center inline-flex items-center justify-center w-12 h-12 shadow-lg rounded-full bg-emerald-500">
                                <i class="fas fa-check-circle"></i>
                              </div>
                            </div>
                          </div>
                          <p class="text-sm text-blueGray-400 mt-4">
                            <span class="text-orange-500 mr-2">
                              <i class="fas fa-arrow-down"></i> 1.10%
                            </span>
                            <span class="whitespace-nowrap">Since yesterday</span>
                          </p>
                        </div>
                      </div>

                      <!-- Performance Card -->
                      <div class="relative flex flex-col min-w-0 break-words bg-blueGray-50 rounded-lg shadow-sm">
                        <div class="flex-auto p-3">
                          <div class="flex flex-wrap">
                            <div class="relative w-full pr-4 max-w-full flex-grow flex-1">
                              <h5 class="text-blueGray-400 uppercase font-bold text-xs">Performance</h5>
                              <span class="font-semibold text-xl text-blueGray-700">{{ performance }}%</span>
                            </div>
                            <div class="relative w-auto pl-4 flex-initial">
                              <div class="text-white p-3 text-center inline-flex items-center justify-center w-12 h-12 shadow-lg rounded-full bg-lightBlue-500">
                                <i class="fas fa-tachometer-alt"></i>
                              </div>
                            </div>
                          </div>
                          <p class="text-sm text-blueGray-400 mt-4">
                            <span class="text-emerald-500 mr-2">
                              <i class="fas fa-arrow-up"></i> 12%
                            </span>
                            <span class="whitespace-nowrap">Since last month</span>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                  </div>
                </div>
              </div>

              <!-- Chat View -->
              <div v-else-if="activeTab === 'chat'" key="chat" class="w-full flex-1 flex justify-start">
                <div class="w-full flex-1">
                  <ChatInterface :key="activeChatId" />
                </div>
              </div>

              <!-- Voice View -->
              <section v-else-if="activeTab === 'voice'" key="voice" class="card">
                <div class="card-body">
                  <VoiceInterface />
                </div>
              </section>

              <!-- Knowledge View -->
              <section v-else-if="activeTab === 'knowledge'" key="knowledge" class="card">
                <div class="card-body p-0">
                  <KnowledgeManager />
                </div>
              </section>

              <!-- Terminal View -->
              <section v-else-if="activeTab === 'terminal'" key="terminal" class="card bg-blueGray-900">
                <div class="card-body p-0">
                  <TerminalWindow />
                </div>
              </section>

              <!-- Workflows View -->
              <section v-else-if="activeTab === 'workflows'" key="workflows" class="card">
                <div class="card-body p-0">
                  <WorkflowApproval />
                </div>
              </section>
              <!-- Settings View -->
              <section v-else-if="activeTab === 'settings'" key="settings" class="card">
                <div class="card-body">
                  <SettingsPanel />
                </div>
              </section>

              <!-- Files View -->
              <section v-else-if="activeTab === 'files'" key="files" class="card">
                <div class="card-body p-0">
                  <FileBrowser />
                </div>
              </section>

              <!-- Monitor View -->
              <section v-else-if="activeTab === 'monitor'" key="monitor" class="card">
                <div class="card-body p-0">
                  <div class="mb-4 px-6 pt-6">
                    <button @click="refreshStats" class="btn btn-primary text-sm">
                      <i class="fas fa-sync mr-2"></i>
                      Refresh
                    </button>
                  </div>
                  <SystemMonitor />
                </div>
              </section>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Global Elevation Dialog -->
  <ElevationDialog
    ref="elevationDialog"
    :show="showElevationDialog"
    :operation="elevationOperation"
    :command="elevationCommand"
    :reason="elevationReason"
    :risk-level="elevationRiskLevel"
    :request-id="elevationRequestId"
    @approved="onElevationApproved"
    @cancelled="onElevationCancelled"
    @close="onElevationClose"
  />
</template>

<script>
import { ref, computed, onMounted, onUnmounted } from 'vue';
import ChatInterface from './components/ChatInterface.vue';
import VoiceInterface from './components/VoiceInterface.vue';
import KnowledgeManager from './components/KnowledgeManager.vue';
import TerminalWindow from './components/TerminalWindow.vue';
import SettingsPanel from './components/SettingsPanel.vue';
import FileBrowser from './components/FileBrowser.vue';
import SystemMonitor from './components/SystemMonitor.vue';
import WorkflowApproval from './components/WorkflowApproval.vue';
import PhaseStatusIndicator from './components/PhaseStatusIndicator.vue';
import ElevationDialog from './components/ElevationDialog.vue';
import elevationService from './services/elevationService';

export default {
  name: 'App',
  components: {
    ChatInterface,
    VoiceInterface,
    KnowledgeManager,
    TerminalWindow,
    SettingsPanel,
    FileBrowser,
    SystemMonitor,
    WorkflowApproval,
    PhaseStatusIndicator,
    ElevationDialog
  },
  setup() {
    const activeTab = ref('dashboard');
    const activeChatId = ref(`chat-${Date.now()}`);
    const navbarOpen = ref(false);
    const mobileMenuContainer = ref(null);
    // Simple tab switching without router
    const updateRoute = (tab) => {
      activeTab.value = tab;
      navbarOpen.value = false; // Close mobile menu
    };

    // Dashboard stats
    const activeSessions = ref(3);
    const knowledgeItems = ref(1247);
    const tasksCompleted = ref(89);
    const performance = ref(92);

    // Connection statuses
    const backendStatus = ref({ text: 'Checking...', class: 'warning', message: 'Connecting to backend...' });
    const llmStatus = ref({ text: 'Checking...', class: 'warning', message: 'Connecting to LLM...' });
    const redisStatus = ref({ text: 'Checking...', class: 'warning', message: 'Connecting to Redis...' });

    const pageTitle = computed(() => {
      const titles = {
        dashboard: 'Dashboard',
        chat: 'AI Assistant',
        voice: 'Voice Interface',
        knowledge: 'Knowledge Base',
        terminal: 'Terminal',
        settings: 'Settings',
        files: 'File Manager',
        monitor: 'System Monitor'
      };
      return titles[activeTab.value] || 'AutoBot';
    });

    const toggleNavbar = () => {
      navbarOpen.value = !navbarOpen.value;
    };

    const closeNavbarOnClickOutside = (event) => {
      if (navbarOpen.value && mobileMenuContainer.value && !mobileMenuContainer.value.contains(event.target)) {
        navbarOpen.value = false;
      }
    };

    const newChat = () => {
      activeChatId.value = `chat-${Date.now()}`;
    };


    const refreshStats = () => {
    };

    // Elevation Dialog state
    const elevationDialog = ref(null);
    const showElevationDialog = ref(false);
    const elevationOperation = ref('');
    const elevationCommand = ref('');
    const elevationReason = ref('');
    const elevationRiskLevel = ref('MEDIUM');
    const elevationRequestId = ref('');

    // Elevation Dialog handlers
    const onElevationApproved = (data) => {
      showElevationDialog.value = false;
    };

    const onElevationCancelled = (requestId) => {
      showElevationDialog.value = false;
    };

    const onElevationClose = () => {
      showElevationDialog.value = false;
    };


    const checkConnectionStatus = async () => {
      try {
        const response = await fetch('http://localhost:8001/api/system/health');
        if (response.ok) {
          const data = await response.json();
          backendStatus.value = { text: 'Connected', class: 'connected', message: 'Backend is running' };
          llmStatus.value = data.llm_status ?
            { text: 'Ready', class: 'connected', message: 'LLM is ready' } :
            { text: 'Error', class: 'error', message: 'LLM connection failed' };
          redisStatus.value = data.redis_status ?
            { text: 'Connected', class: 'connected', message: 'Redis is running' } :
            { text: 'Error', class: 'error', message: 'Redis connection failed' };
        } else {
          backendStatus.value = { text: 'Error', class: 'error', message: 'Backend connection failed' };
        }
      } catch (error) {
        backendStatus.value = { text: 'Offline', class: 'error', message: 'Cannot reach backend' };
        llmStatus.value = { text: 'Unknown', class: 'warning', message: 'Status unknown' };
        redisStatus.value = { text: 'Unknown', class: 'warning', message: 'Status unknown' };
      }
    };

    let statusCheckInterval;

    onMounted(() => {
      checkConnectionStatus();
      statusCheckInterval = setInterval(checkConnectionStatus, 10000);

      // Add click-outside listener for mobile menu
      document.addEventListener('click', closeNavbarOnClickOutside);

      // Register elevation dialog with service
      if (elevationDialog.value) {
        elevationService.registerDialog(elevationDialog.value);
      }

      // Simulate dashboard updates
      setInterval(() => {
        activeSessions.value = Math.floor(Math.random() * 5) + 1;
        performance.value = Math.floor(Math.random() * 20) + 80;
      }, 5000);
    });

    onUnmounted(() => {
      if (statusCheckInterval) {
        clearInterval(statusCheckInterval);
      }
      // Remove click-outside listener
      document.removeEventListener('click', closeNavbarOnClickOutside);
    });

    return {
      activeTab,
      activeChatId,
      navbarOpen,
      mobileMenuContainer,
      backendStatus,
      llmStatus,
      redisStatus,
      pageTitle,
      activeSessions,
      knowledgeItems,
      tasksCompleted,
      performance,
      toggleNavbar,
      updateRoute,
      newChat,
      refreshStats,
      // Elevation Dialog
      elevationDialog,
      showElevationDialog,
      elevationOperation,
      elevationCommand,
      elevationReason,
      elevationRiskLevel,
      elevationRequestId,
      onElevationApproved,
      onElevationCancelled,
      onElevationClose
    };
  }
};
</script>

<style>
@import './assets/vue-notus.css';
@import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css');

/* Vue Notus Color Mappings for App.vue */
.bg-blueGray-50 { background-color: var(--blue-gray-50); }
.bg-blueGray-100 { background-color: var(--blue-gray-100); }
.bg-blueGray-200 { background-color: var(--blue-gray-200); }
.bg-blueGray-400 { background-color: var(--blue-gray-400); }
.bg-blueGray-800 { background-color: var(--blue-gray-800); }
.bg-blueGray-900 { background-color: var(--blue-gray-900); }

.text-blueGray-200 { color: var(--blue-gray-200); }
.text-blueGray-400 { color: var(--blue-gray-400); }
.text-blueGray-600 { color: var(--blue-gray-600); }
.text-blueGray-700 { color: var(--blue-gray-700); }

.text-indigo-500 { color: var(--indigo-500); }
.bg-indigo-50 { background-color: var(--indigo-50); }
.bg-indigo-500 { background-color: var(--indigo-500); }
.bg-indigo-600 { background-color: var(--indigo-600); }
.bg-indigo-700 { background-color: var(--indigo-700); }
.bg-indigo-800 { background-color: var(--indigo-800); }

.text-emerald-500 { color: var(--emerald-500); }
.bg-emerald-500 { background-color: var(--emerald-500); }
.text-red-500 { color: var(--red-500); }
.bg-red-500 { background-color: var(--red-500); }
.bg-orange-500 { background-color: var(--orange-500); }
.text-orange-500 { color: var(--orange-500); }

.border-blueGray-200 { border-color: var(--blue-gray-200); }

.hover\\:text-blueGray-500:hover { color: var(--blue-gray-500); }
.hover\\:text-white:hover { color: white; }
.active\\:bg-indigo-600:active { background-color: var(--indigo-600); }

/* Gradient backgrounds */
.from-indigo-500 { --tw-gradient-from: var(--indigo-500); }
.to-indigo-700 { --tw-gradient-to: var(--indigo-700); }
.from-indigo-600 { --tw-gradient-from: var(--indigo-600); }
.to-indigo-800 { --tw-gradient-to: var(--indigo-800); }
.bg-gradient-to-br {
  background: linear-gradient(to bottom right, var(--tw-gradient-from, var(--indigo-500)), var(--tw-gradient-to, var(--indigo-700)));
}
.bg-gradient-to-r {
  background: linear-gradient(to right, var(--tw-gradient-from, var(--indigo-500)), var(--tw-gradient-to, var(--indigo-600)));
}

/* Light blue colors for dashboard cards */
.bg-lightBlue-500 { background-color: #0ea5e9; }
.text-lightBlue-500 { color: #0ea5e9; }

/* Table styling */
.divide-y > * + * { border-top-width: 1px; }
.divide-blueGray-200 > * + * { border-color: var(--blue-gray-200); }
.min-w-full { min-width: 100%; }
.overflow-x-auto { overflow-x: auto; }
.h-8 { height: 2rem; }
.w-8 { width: 2rem; }
.-m-12 { margin: -3rem; }
.-mt-6 { margin-top: -1.5rem; }
.mt-0 { margin-top: 0; }
.grid { display: grid; }
.grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
.gap-4 { gap: 1rem; }
.bg-yellow-100 { background-color: #fef3c7; }
.text-yellow-800 { color: #92400e; }
.mb-4 { margin-bottom: 1rem; }
.space-y-2 > * + * { margin-top: 0.5rem; }
.text-indigo-200 { color: #c7d2fe; }
.bg-opacity-10 { background-color: rgba(255, 255, 255, 0.1); }
.bg-opacity-20 { background-color: rgba(255, 255, 255, 0.2); }
.hover\:bg-opacity-10:hover { background-color: rgba(255, 255, 255, 0.1); }
.h-screen { height: 100vh; }
.justify-start { justify-content: flex-start; }
.top-full { top: 100%; }
.backdrop-blur-sm { backdrop-filter: blur(4px); }
.bg-opacity-95 { background-color: rgba(255, 255, 255, 0.95); }
.border-opacity-20 { border-color: rgba(255, 255, 255, 0.2); }
.mx-4 { margin-left: 1rem; margin-right: 1rem; }
.mt-2 { margin-top: 0.5rem; }
.hover\:bg-indigo-50:hover { background-color: var(--indigo-50); }
.hover\:text-indigo-600:hover { color: var(--indigo-600); }
.w-64 { width: 16rem; }

/* Essential layout utilities missing from Vue Notus */
.items-center { align-items: center; }
.justify-between { justify-content: space-between; }
.flex-wrap { flex-wrap: wrap; }
.flex-nowrap { flex-wrap: nowrap; }
.flex-col { flex-direction: column; }
.flex-row { flex-direction: row; }
.min-h-full { min-height: 100%; }
.min-h-screen { min-height: 100vh; }
.list-none { list-style: none; }
.block { display: block; }
.relative { position: relative; }
.absolute { position: absolute; }
.fixed { position: fixed; }
.z-10 { z-index: 10; }
.z-40 { z-index: 40; }
.z-50 { z-index: 50; }
.z-60 { z-index: 60; }
.z-70 { z-index: 70; }
.overflow-hidden { overflow: hidden; }
.overflow-y-auto { overflow-y: auto; }
.overflow-x-hidden { overflow-x: hidden; }
.mx-auto { margin-left: auto; margin-right: auto; }
.mt-auto { margin-top: auto; }
.mt-4 { margin-top: 1rem; }
.mt-6 { margin-top: 1.5rem; }
.mb-3 { margin-bottom: 0.75rem; }
.mb-6 { margin-bottom: 1.5rem; }
.mb-12 { margin-bottom: 3rem; }
.ml-3 { margin-left: 0.75rem; }
.mr-2 { margin-right: 0.5rem; }
.pt-6 { padding-top: 1.5rem; }
.pt-8 { padding-top: 2rem; }
.pt-12 { padding-top: 3rem; }
.pb-16 { padding-bottom: 4rem; }
.pb-32 { padding-bottom: 8rem; }
.px-0 { padding-left: 0; padding-right: 0; }
.px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
.px-4 { padding-left: 1rem; padding-right: 1rem; }
.px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
.py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
.py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
.py-4 { padding-top: 1rem; padding-bottom: 1rem; }
.w-full { width: 100%; }
.w-12 { width: 3rem; }
.h-12 { height: 3rem; }
.h-auto { height: auto; }
.max-w-full { max-width: 100%; }
.flex-grow { flex-grow: 1; }
.flex-initial { flex: 0 1 auto; }
.flex-auto { flex: 1 1 auto; }
.flex-1 { flex: 1 1 0%; }
.whitespace-nowrap { white-space: nowrap; }
.cursor-pointer { cursor: pointer; }
.uppercase { text-transform: uppercase; }
.font-bold { font-weight: 700; }
.font-semibold { font-weight: 600; }
.text-xs { font-size: 0.75rem; line-height: 1rem; }
.text-sm { font-size: 0.875rem; line-height: 1.25rem; }
.text-lg { font-size: 1.125rem; line-height: 1.75rem; }
.text-xl { font-size: 1.25rem; line-height: 1.75rem; }
.text-2xl { font-size: 1.5rem; line-height: 2rem; }
.tracking-wider { letter-spacing: 0.05em; }
.space-y-2 > * + * { margin-top: 0.5rem; }
.space-y-3 > * + * { margin-top: 0.75rem; }
.space-x-2 > * + * { margin-left: 0.5rem; }
.space-x-4 > * + * { margin-left: 1rem; }

.inline-flex { display: inline-flex; }
.ml-auto { margin-left: auto; }
.flex-shrink-0 { flex-shrink: 0; }
.justify-center { justify-content: center; }

/* Medium screen grid utilities */
@media (min-width: 768px) {
  .md\\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}

/* Large screen grid utilities */
@media (min-width: 1024px) {
  .lg\\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
}

/* Responsive utilities */
@media (min-width: 768px) {
  .md\\:left-0 { left: 0; }
  .md\\:block { display: block; }
  .md\\:fixed { position: fixed; }
  .md\\:top-0 { top: 0; }
  .md\\:bottom-0 { bottom: 0; }
  .md\\:w-64 { width: 16rem; }
  .md\\:flex { display: flex; }
  .md\\:flex-col { flex-direction: column; }
  .md\\:flex-row { flex-direction: row; }
  .md\\:flex-nowrap { flex-wrap: nowrap; }
  .md\\:items-stretch { align-items: stretch; }
  .md\\:min-h-full { min-height: 100%; }
  .md\\:min-w-full { min-width: 100%; }
  .md\\:opacity-100 { opacity: 1; }
  .md\\:relative { position: relative; }
  .md\\:mt-4 { margin-top: 1rem; }
  .md\\:shadow-none { box-shadow: none; }
  .md\\:overflow-y-auto { overflow-y: auto; }
  .md\\:overflow-hidden { overflow: hidden; }
  .md\\:hidden { display: none; }
  .md\\:ml-64 { margin-left: 16rem; }
  .md\\:flex-nowrap { flex-wrap: nowrap; }
  .md\\:justify-start { justify-content: flex-start; }
  .md\\:px-10 { padding-left: 2.5rem; padding-right: 2.5rem; }
  .md\\:pt-16 { padding-top: 4rem; }
  .md\\:pt-32 { padding-top: 8rem; }
}

/* Transitions */
.fade-slide-enter-active,
.fade-slide-leave-active {
  transition: all 0.3s ease;
}

.fade-slide-enter-from {
  transform: translateY(10px);
  opacity: 0;
}

.fade-slide-leave-to {
  transform: translateY(-10px);
  opacity: 0;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f5f9;
}

::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}
</style>
